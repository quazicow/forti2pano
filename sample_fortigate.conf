#config-version=FG100F-7.2.3-FW-build1262-230221:opmode=0:vdom=0
#conf_file_ver=123456789
#buildno=1262
#global_vdom=1

config system global
    set hostname "FW-HQ-01"
    set timezone "US/Eastern"
end

config system interface
    edit "port1"
        set vdom "root"
        set ip 203.0.113.10 255.255.255.0
        set allowaccess ping https ssh
        set type physical
        set alias "WAN"
        set description "Internet uplink"
    next
    edit "port2"
        set vdom "root"
        set ip 10.0.1.1 255.255.255.0
        set allowaccess ping https ssh
        set type physical
        set alias "LAN"
        set description "Internal LAN"
    next
    edit "port3"
        set vdom "root"
        set ip 172.16.0.1 255.255.255.0
        set allowaccess ping https
        set type physical
        set alias "DMZ"
        set description "DMZ segment"
    next
    edit "port4"
        set vdom "root"
        set ip 10.0.2.1 255.255.255.0
        set allowaccess ping
        set type physical
        set alias "SERVERS"
        set description "Server VLAN"
    next
    edit "loopback0"
        set vdom "root"
        set ip 10.255.255.1 255.255.255.255
        set type loopback
    next
end

config system zone
    edit "WAN-Zone"
        set interface "port1"
    next
    edit "LAN-Zone"
        set interface "port2" "port4"
    next
    edit "DMZ-Zone"
        set interface "port3"
    next
end

config firewall address
    edit "WebServer1"
        set subnet 10.0.1.100 255.255.255.255
        set associated-interface "port2"
        set comment "Primary web server"
    next
    edit "WebServer2"
        set subnet 10.0.1.101 255.255.255.255
        set associated-interface "port2"
        set comment "Secondary web server"
    next
    edit "DBServer"
        set subnet 10.0.2.50 255.255.255.255
        set associated-interface "port4"
        set comment "Database server"
    next
    edit "DMZ-WebApp"
        set subnet 172.16.0.10 255.255.255.255
        set associated-interface "port3"
        set comment "DMZ web application"
    next
    edit "Branch-Net"
        set subnet 10.0.3.0 255.255.255.0
        set comment "Branch office network"
    next
    edit "RemoteOffice-Net"
        set subnet 10.0.4.0 255.255.255.0
        set comment "Remote office network"
    next
    edit "GoogleDNS"
        set type fqdn
        set fqdn "dns.google.com"
        set comment "Google DNS FQDN"
    next
    edit "PartnerRange"
        set type iprange
        set start-ip 192.168.100.1
        set end-ip 192.168.100.50
        set comment "Partner IP range"
    next
    edit "LAN-Subnet"
        set subnet 10.0.1.0 255.255.255.0
        set comment "Full LAN subnet"
    next
    edit "Server-Subnet"
        set subnet 10.0.2.0 255.255.255.0
        set comment "Server subnet"
    next
end

config firewall addrgrp
    edit "WebServers"
        set member "WebServer1" "WebServer2"
        set comment "All web servers"
    next
    edit "Internal-All"
        set member "LAN-Subnet" "Server-Subnet"
        set comment "All internal subnets"
    next
end

config firewall service custom
    edit "HTTPS-8443"
        set tcp-portrange 8443
        set comment "HTTPS on port 8443"
    next
    edit "App-Custom"
        set tcp-portrange 9000-9100
        set comment "Custom application ports"
    next
    edit "DNS-TCP-UDP"
        set tcp-portrange 53
        set udp-portrange 53
        set comment "DNS over TCP and UDP"
    next
    edit "MSSQL-Custom"
        set tcp-portrange 1433-1434
        set comment "MSSQL ports"
    next
    edit "ICMP-Ping"
        set protocol ICMP
        set icmptype 8
        set icmpcode 0
        set comment "ICMP echo request"
    next
end

config firewall service group
    edit "Web-Services"
        set member "HTTP" "HTTPS" "HTTPS-8443"
    next
end

config firewall vip
    edit "WebApp-VIP"
        set extip 203.0.113.20
        set mappedip "172.16.0.10"
        set extintf "port1"
        set portforward enable
        set extport 443
        set mappedport 8443
    next
    edit "WebServer-VIP"
        set extip 203.0.113.21
        set mappedip "10.0.1.100"
        set extintf "port1"
    next
end

config firewall ippool
    edit "SNAT-Pool"
        set startip 203.0.113.30
        set endip 203.0.113.35
        set type overload
    next
end

config firewall policy
    edit 1
        set name "LAN-to-WAN"
        set srcintf "port2"
        set dstintf "port1"
        set srcaddr "LAN-Subnet"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
        set logtraffic all
        set nat enable
        set ippool enable
        set poolname "SNAT-Pool"
        set comments "Allow LAN to Internet with SNAT"
    next
    edit 2
        set name "Servers-to-WAN"
        set srcintf "port4"
        set dstintf "port1"
        set srcaddr "Server-Subnet"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "HTTP" "HTTPS" "DNS"
        set logtraffic all
        set nat enable
        set comments "Servers Internet access"
    next
    edit 3
        set name "WAN-to-DMZ-WebApp"
        set srcintf "port1"
        set dstintf "port3"
        set srcaddr "all"
        set dstaddr "WebApp-VIP"
        set action accept
        set schedule "always"
        set service "HTTPS"
        set logtraffic all
        set av-profile "default"
        set ips-sensor "high-security"
        set webfilter-profile "default"
        set comments "Public HTTPS to DMZ web app"
    next
    edit 4
        set name "WAN-to-WebServer"
        set srcintf "port1"
        set dstintf "port2"
        set srcaddr "all"
        set dstaddr "WebServer-VIP"
        set action accept
        set schedule "always"
        set service "HTTP" "HTTPS"
        set logtraffic all
        set av-profile "default"
        set ips-sensor "default"
        set comments "Public access to web servers"
    next
    edit 5
        set name "LAN-to-DMZ"
        set srcintf "port2"
        set dstintf "port3"
        set srcaddr "LAN-Subnet"
        set dstaddr "DMZ-WebApp"
        set action accept
        set schedule "always"
        set service "HTTPS" "HTTPS-8443" "SSH"
        set logtraffic utm
        set comments "LAN management access to DMZ"
    next
    edit 6
        set name "LAN-to-Servers"
        set srcintf "port2"
        set dstintf "port4"
        set srcaddr "LAN-Subnet"
        set dstaddr "Server-Subnet"
        set action accept
        set schedule "always"
        set service "ALL"
        set logtraffic utm
        set comments "LAN to server access"
    next
    edit 7
        set name "DMZ-to-Servers"
        set srcintf "port3"
        set dstintf "port4"
        set srcaddr "DMZ-WebApp"
        set dstaddr "DBServer"
        set action accept
        set schedule "always"
        set service "MSSQL-Custom"
        set logtraffic all
        set comments "DMZ app to database"
    next
    edit 8
        set name "Deny-DMZ-to-LAN"
        set srcintf "port3"
        set dstintf "port2"
        set srcaddr "all"
        set dstaddr "all"
        set action deny
        set schedule "always"
        set service "ALL"
        set logtraffic all
        set comments "Block DMZ to LAN"
    next
    edit 9
        set name "VPN-Branch-Access"
        set srcintf "port2"
        set dstintf "port1"
        set srcaddr "LAN-Subnet"
        set dstaddr "Branch-Net"
        set action accept
        set schedule "always"
        set service "ALL"
        set logtraffic all
        set comments "LAN to branch via VPN"
    next
    edit 10
        set name "Branch-to-LAN"
        set srcintf "port1"
        set dstintf "port2"
        set srcaddr "Branch-Net"
        set dstaddr "LAN-Subnet"
        set action accept
        set schedule "always"
        set service "ALL"
        set logtraffic all
        set comments "Branch to LAN via VPN"
    next
end

config router static
    edit 1
        set gateway 203.0.113.1
        set device "port1"
    next
    edit 2
        set dst 10.0.3.0 255.255.255.0
        set gateway 10.0.1.254
        set device "port2"
        set comment "Route to branch via VPN"
    next
    edit 3
        set dst 10.0.4.0 255.255.255.0
        set gateway 10.0.1.254
        set device "port2"
        set comment "Route to remote office"
    next
end

config vpn ipsec phase1-interface
    edit "VPN-to-Branch"
        set interface "port1"
        set peertype any
        set proposal aes256-sha256
        set remote-gw 198.51.100.1
        set psksecret ENC XXXXXXXXXXXXXXXXXXXX
        set ike-version 2
        set dhgrp 14 20
        set keylife 28800
        set dpd on-idle
        set nattraversal enable
    next
    edit "VPN-to-RemoteOffice"
        set interface "port1"
        set peertype any
        set proposal aes256-sha256 aes128-sha256
        set remote-gw 198.51.100.50
        set psksecret ENC YYYYYYYYYYYYYYYYYYYY
        set ike-version 1
        set mode main
        set dhgrp 14
        set keylife 86400
        set nattraversal enable
    next
end

config vpn ipsec phase2-interface
    edit "VPN-to-Branch-P2"
        set phase1name "VPN-to-Branch"
        set proposal aes256-sha256
        set dhgrp 14
        set src-subnet 10.0.1.0 255.255.255.0
        set dst-subnet 10.0.3.0 255.255.255.0
        set keylifeseconds 3600
    next
    edit "VPN-to-RemoteOffice-P2"
        set phase1name "VPN-to-RemoteOffice"
        set proposal aes256-sha256
        set dhgrp 14
        set src-subnet 10.0.1.0 255.255.255.0
        set dst-subnet 10.0.4.0 255.255.255.0
        set keylifeseconds 43200
    next
end
